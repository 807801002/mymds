# 内容提要

本书从Web服务器相关基础知识原理开始逐步深入Tomcat内部设计。比如涵盖了HTTP协议、Socket通信及服务器模型等必备的基础知识。另外还包括Servlet规范，这些都是深入Tomcat必不可少的知识。然后介绍了Tomcat的启动和关闭过程，接着从整体预览Tomcat的内部结构，让读者对Tomcat内部有个整体的了解。最后开始层层剖析Tomcat内部结构，包括Server组件、Service组件、内存泄漏检测、Connector组件（HTTP协议、AJP协议、BIO模式、NIO模式和APR模式）、Engine容器、Host容器、Context容器、Wrapper容器（Servlet种类机制、Comet模式、WebSocket协议、异步Servlet），生命周期管理、日志框架及其国际化（日志系统、日志国际化及访问日志），公共与隔离的加载器（多个Web应用如何做到资源隔离），Mapper组件（局部路由、全局路由）、Tomcat集成JNDI、JSP编译器（JSP语法解析、JSP变异成Servlet、Servlet编译成Class）、运行及通信安全管理、处理请求和响应的管道（管道机制）、多样化的会话管理器（标准会话管理器、持久化会话管理器、集群增量会话管理器及集群备份管理器）、高可用的Tomcat集群的实现（从单机到集群），Tomcat集群通信框架，Tomcat内部监控与管理。

# 第1章 Web服务器机制

* 通信协议
* Socket通信
* Web服务模型

## 1.1 通信协议

### 1.1.1 HTTP/HTTPS

SSL/TLS协议层主要的职责就是借助下层协议的信道安全地协商出一份加密密钥，并且用此密钥来加密HTTP请求响应报文。它解决了以下三个安全性方面问题

* 提供验证服务，验证本次会话实体身份的合法性
* 提供加密服务，强加密机制能保证通信过程中的消息不被破译
* 提供防篡改服务，利用Hash算法对消息进行签名，通过验证签名保证通信内容不被篡改

加密算法与Hash算法

* 对称加密。密钥只有一个，加密、解密都是这个密码，加解密速度快，典型的对称加密算法有DES、AES、RC4等
* 非对称加密。密钥成对出现，分为公钥和私钥，从公钥无法推知私钥，反之，从私钥也不能推知公钥。加密、解密使用不同的密钥，公钥加密需要私钥解密，反之私钥加密需要公钥解密。非对称加密速度较慢，典型的非对称加密算法有RSA、DSA、DSS等。
* Hash算法，这是一种不可逆的算法，它常用语验证数据的完整性

SSL七次握手

1. 客户端浏览器向服务端发送SSL/TLS协议的版本号、加密算法的种类、产生的随机数，以及其他需要的各种信息
2. 服务器从客户端支持的加密算法中选择一组加密算法与Hash算法，并把自己的证书（包含网站地址、加密公钥、证书颁发机构等）也发送给客户端
3. 浏览器获取服务器证书后验证其合法性，验证颁发机构是否合法，验证证书中的网址是否与正在访问的地址一致，通过验证的浏览器会显示一个小锁头，否则，提示证书不受信
4. 客户端浏览器生成一串随机数并用服务器传来的公钥加密，在使用约定好的Hash算法计算握手消息，发送到服务器端
5. 服务器接到握手消息后用自己的私钥解密，并用散列算法验证，这样双方都有了其次通信的密钥
6. 服务器再使用密钥加密一段握手消息，返回给客户端浏览器
7. 浏览器用密钥解密，并用散列算法验证，确定算法与密钥

## 1.2 套接字通信

Socket通信是应用层与TCP/IP协议族通信的中间抽象层，它是一组接口。应用层通过调用这些接口发送和接收数据。